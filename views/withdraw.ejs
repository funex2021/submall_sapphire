<!DOCTYPE html>
<html lang="ko">
<head>
    <%- include('includes/cdn') %>
    <title><%= config.found_text %> | History</title>
</head>
<body class="@@dashboard">
<div id="main-wrapper" class="show">
    <%- include('includes/header') %>
    <%- include('includes/nav') %>
    <div class="content-body">
        <div class="container">
            <div class="row">
                <div class="col-xxl-12">
                    <div class="card">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">구매내역</h4>
                            </div>
                            <div class="card-header">
                                <div class="header-left search">
                                    <span>
                                        <i class="ri-calendar-line"></i>
                                    </span>
                                    <input type="text" id="startDatePicker" class="form-control" value="<%= srtDt %>" placeholder="<%= srtDt %>">
                                    <span>
                                        <i class="ri-calendar-line"></i>
                                    </span>
                                    <input type="text" id="endDatePicker" class="form-control" value="<%= endDt %>" placeholder="<%= endDt %>">
                                    <a href="#n" class="btn btn-dark w-30" onclick="fnSearch();">검색</a>
                                </div>
                            </div>

                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th>날짜</th>
                                            <th>sales</th>
                                            <th>상태</th>
                                            <th>포인트</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <% if (withdrawList.length > 0) {
                                        withdrawList.forEach(function(el, index) { %>
                                            <%
                                                let buy_num = 0;
                                                if (el.buy_num) buy_num = el.buy_num;
                                            %>
                                            <tr>
                                                <td><%= el.create_dt %></td>
                                                <td><%= el.title %></td>
                                                <td>
                                                    <% let status = el.confirm_sts_name %>
                                                    <% switch (status) {
                                                    case '취소': %>
                                                    취소
                                                    <% break;
                                                    case '대기': %>
                                                    대기
                                                    <% break;
                                                    case '완료': %>
                                                    승인
                                                    <% break;
                                                        default:
                                                            break; } %>
                                                </td>
                                                <td><%= parseInt(buy_num).toLocaleString('ko-KR') %> Point</td>
                                            </tr>
                                        <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="4" style="text-align: center;">내역이 없습니다.</td>
                                            </tr>
                                        <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <%- include('includes/paging') %>
                            <input type="hidden" id="pageIndex" value="<%= pagination.pageIndex %>">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    $(function () {
        $('#startDatePicker').datepicker({
            format: "yyyy-mm-dd",	//데이터 포맷 형식(yyyy : 년 mm : 월 dd : 일 )
            autoclose : true,	//사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
            calendarWeeks : false, //캘린더 옆에 몇 주차인지 보여주는 옵션 기본값 false 보여주려면 true
            clearBtn : false, //날짜 선택한 값 초기화 해주는 버튼 보여주는 옵션 기본값 false 보여주려면 true
            immediateUpdates: true,
            templates : {
                leftArrow: '&laquo;',
                rightArrow: '&raquo;'
            }, //다음달 이전달로 넘어가는 화살표 모양 커스텀 마이징
            showWeekDays : true ,// 위에 요일 보여주는 옵션 기본값 : true
            todayHighlight : true ,	//오늘 날짜에 하이라이팅 기능 기본값 :false
            toggleActive : true,	//이미 선택된 날짜 선택하면 기본값 : false인경우 그대로 유지 true인 경우 날짜 삭제
            weekStart : 0 ,//달력 시작 요일 선택하는 것 기본값은 0인 일요일
            language : "ko"	//달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.
        });//datepicker end

        $('#endDatePicker').datepicker({
            format: "yyyy-mm-dd",	//데이터 포맷 형식(yyyy : 년 mm : 월 dd : 일 )
            autoclose : true,	//사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
            calendarWeeks : false, //캘린더 옆에 몇 주차인지 보여주는 옵션 기본값 false 보여주려면 true
            clearBtn : false, //날짜 선택한 값 초기화 해주는 버튼 보여주는 옵션 기본값 false 보여주려면 true
            templates : {
                leftArrow: '&laquo;',
                rightArrow: '&raquo;'
            }, //다음달 이전달로 넘어가는 화살표 모양 커스텀 마이징
            showWeekDays : true ,// 위에 요일 보여주는 옵션 기본값 : true
            todayHighlight : true ,	//오늘 날짜에 하이라이팅 기능 기본값 :false
            toggleActive : true,	//이미 선택된 날짜 선택하면 기본값 : false인경우 그대로 유지 true인 경우 날짜 삭제
            weekStart : 0 ,//달력 시작 요일 선택하는 것 기본값은 0인 일요일
            language : "ko"	//달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.

        });//datepicker end
    });

    function fnSearch() {
        let srtDt = $("#startDatePicker").val();
        let endDt = $("#endDatePicker").val();
        let pageIndex = $("#pageIndex").val();

        console.log(srtDt)
        console.log(endDt)
        console.log(pageIndex)

        var form = document.createElement("form");
        form.setAttribute("charset", "UTF-8");
        form.setAttribute("method", "Post"); //Post 방식
        form.setAttribute("action", "/p/view"); //요청 보낼 주소
        var hiddenField1 = document.createElement("input");
        hiddenField1.setAttribute("type", "hidden");
        hiddenField1.setAttribute("name", "pageIndex");
        hiddenField1.setAttribute("value", pageIndex);
        form.appendChild(hiddenField1);
        var hiddenField2 = document.createElement("input");
        hiddenField2.setAttribute("type", "hidden");
        hiddenField2.setAttribute("name", "srtDt");
        hiddenField2.setAttribute("value", srtDt);
        form.appendChild(hiddenField2);
        var hiddenField3 = document.createElement("input");
        hiddenField3.setAttribute("type", "hidden");
        hiddenField3.setAttribute("name", "endDt");
        hiddenField3.setAttribute("value", endDt);
        form.appendChild(hiddenField3);

        document.body.appendChild(form);
        form.submit();
    }
</script>